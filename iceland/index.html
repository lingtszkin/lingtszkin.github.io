<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‡®ğŸ‡¸ å†°å³¶è¡Œç¨‹ V2</title>
    <style>
        :root {
            --primary: #005eb8;
            --accent: #d62828;
            --bg: #f4f4f9;
            --card-bg: #ffffff;
            --text: #333;
            --border-radius: 12px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            padding-bottom: 100px;
        }

        /* Header & Controls */
        header {
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        h1 { margin: 0; font-size: 1.1rem; font-weight: 600; }
        
        .toggle-edit {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.4);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
        }
        .toggle-edit.active {
            background: #fff;
            color: var(--primary);
            font-weight: bold;
        }

        .container { max-width: 600px; margin: 0 auto; padding: 10px; }

        /* Date Group Header */
        .date-header {
            background: #eef2f5;
            color: var(--primary);
            padding: 10px 15px;
            margin: 15px 0 10px 0;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            position: sticky;
            top: 60px;
            z-index: 90;
            border-left: 5px solid var(--primary);
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: relative;
            border-left: 4px solid transparent;
        }
        .card.type-ä½å®¿ { border-left-color: #9b59b6; }
        .card.type-ç€‘å¸ƒ { border-left-color: #3498db; }
        .card.type-ç«å±± { border-left-color: #e74c3c; }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .time-badge {
            background: #eee;
            color: #555;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-family: monospace;
            font-weight: 600;
        }
        
        /* Location Link Style */
        .location-row {
            display: flex;
            align-items: center;
            margin: 8px 0 4px 0;
            cursor: pointer;
        }
        .location {
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            text-decoration: none;
        }
        .search-icon {
            margin-left: 8px;
            font-size: 0.9rem;
            color: var(--primary);
            opacity: 0.7;
        }
        
        .item-name { color: #666; font-size: 0.9rem; margin-bottom: 8px; }
        .tags { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 8px; }
        .tag { font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; background: #f0f0f0; color: #555; }
        .tag.drive { background: #fff3cd; color: #856404; }

        /* Remarks */
        .remark-box {
            margin-top: 8px;
            padding: 8px;
            background: #fffde7;
            border-radius: 6px;
            font-size: 0.9rem;
            color: #444;
            border: 1px dashed #e6e600;
            min-height: 30px;
        }
        .remark-placeholder { color: #aaa; font-style: italic; }

        /* Edit Controls (Hidden by default) */
        .edit-controls {
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            justify-content: flex-end;
            gap: 8px;
        }
        body.edit-mode .edit-controls { display: flex; }
        
        .btn {
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .btn-up { background: #e3f2fd; color: #1565c0; }
        .btn-down { background: #e3f2fd; color: #1565c0; }
        .btn-del { background: #ffebee; color: #c62828; }
        .btn-edit-content { background: #f3e5f5; color: #7b1fa2; }

        /* Floating Add Button */
        .fab-add {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 56px;
            height: 56px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 200;
            display: none; /* Only in edit mode */
        }
        body.edit-mode .fab-add { display: flex; }

        /* Modal */
        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; padding: 20px; width: 90%; max-width: 400px;
            border-radius: 12px; max-height: 90vh; overflow-y: auto;
        }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;
            font-size: 1rem;
        }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }

    </style>
</head>
<body>

<header>
    <h1 id="pageTitle">ğŸ‡®ğŸ‡¸ å†°å³¶è¡Œç¨‹ V2</h1>
    <button class="toggle-edit" onclick="toggleEditMode()">ç·¨è¼¯æ¨¡å¼</button>
</header>

<div id="app" class="container"></div>

<!-- Floating Add Button -->
<div class="fab-add" onclick="openAddModal()">â•</div>

<!-- Edit/Add Modal -->
<div id="itemModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">ç·¨è¼¯è¡Œç¨‹</h3>
        <div class="form-group">
            <label>æ—¥æœŸ (åˆ†çµ„ç”¨)</label>
            <input type="text" id="inpDate" placeholder="e.g. 5/1/2025">
        </div>
        <div class="form-group">
            <label>æ™‚é–“</label>
            <div style="display:flex; gap:5px">
                <input type="text" id="inpArrTime" placeholder="æŠµé” (09:00)">
                <input type="text" id="inpLeaveTime" placeholder="é›¢é–‹ (10:00)">
            </div>
        </div>
        <div class="form-group">
            <label>åœ°é» (Google Search é—œéµå­—)</label>
            <input type="text" id="inpLocation">
        </div>
        <div class="form-group">
            <label>é …ç›®åç¨±</label>
            <input type="text" id="inpName">
        </div>
        <div class="form-group">
            <label>å‚™è¨» / Remarks</label>
            <textarea id="inpRemark" rows="3"></textarea>
        </div>
        <div class="modal-actions">
            <button class="btn btn-del" onclick="closeModal()" style="background:#eee; color:#333">å–æ¶ˆ</button>
            <button class="btn btn-up" onclick="saveItem()" style="background:var(--primary); color:white">å„²å­˜</button>
        </div>
    </div>
</div>

<script>
    // Initial Static Data (Backup)
    const initialData = [
        {"Date": "5/1/2025", "Arriving Time": "07:50", "Leaving Time": "09:00", "è»Šç¨‹": "", "Location": "KEF airport", "é …ç›®": "KEF airport", "é¡å‹": "", "remarks": ""},
        {"Date": "5/1/2025", "Arriving Time": "10:00", "Leaving Time": "12:00", "è»Šç¨‹": "45 mins", "Location": "RÃ¡Ã°hÃºsiÃ°", "é …ç›®": "Reykjavik city tour", "é¡å‹": "åŸå¸‚", "remarks": ""},
        {"Date": "5/1/2025", "Arriving Time": "14:00", "Leaving Time": "14:15", "è»Šç¨‹": "1 hour 41 mins", "Location": "Hraunfossar", "é …ç›®": "Hraunfossar", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/1/2025", "Arriving Time": "15:45", "Leaving Time": "16:00", "è»Šç¨‹": "1 hour 19 mins", "Location": "GerÃ°uberg Cliffs", "é …ç›®": "GerÃ°uberg Cliffs", "é¡å‹": "çŸ³", "remarks": ""},
        {"Date": "5/1/2025", "Arriving Time": "16:30", "Leaving Time": "16:45", "è»Šç¨‹": "33 mins", "Location": "Ytri Tunga", "é …ç›®": "Ytri Tunga", "é¡å‹": "æµ·è±¹", "remarks": ""},
        {"Date": "5/1/2025", "Arriving Time": "17:15", "Leaving Time": "17:30", "è»Šç¨‹": "34 mins", "Location": "LÃ³ndrangar", "é …ç›®": "LÃ³ndrangar", "é¡å‹": "çŸ³", "remarks": ""},
        {"Date": "5/1/2025", "Arriving Time": "18:15", "Leaving Time": "18:30", "è»Šç¨‹": "45 mins", "Location": "Kirkjufellsfoss", "é …ç›®": "Kirkjufellsfoss", "é¡å‹": "å±±", "remarks": ""},
        {"Date": "5/1/2025", "Arriving Time": "", "Leaving Time": "", "è»Šç¨‹": "33 mins", "Location": "Illugastadir seal watching", "é …ç›®": "Illugastadir seal watching", "é¡å‹": "æµ·è±¹", "remarks": ""},
        {"Date": "5/1/2025", "Arriving Time": "22:00", "Leaving Time": "", "è»Šç¨‹": "2 hours 35 mins", "Location": "Hvammstangi", "é …ç›®": "Hvammstangi", "é¡å‹": "ä½å®¿", "remarks": ""},
        {"Date": "5/2/2025", "Arriving Time": "10:30", "Leaving Time": "10:45", "è»Šç¨‹": "2 hours 32 mins", "Location": "Hallandsnes, 606, Iceland", "é …ç›®": "Foss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/2/2025", "Arriving Time": "10:45", "Leaving Time": "11:15", "è»Šç¨‹": "32 mins", "Location": "GoÃ°afoss", "é …ç›®": "GoÃ°afoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/2/2025", "Arriving Time": "11:30", "Leaving Time": "12:30", "è»Šç¨‹": "44 mins", "Location": "Dimmuborgir", "é …ç›®": "Dimmuborgir", "é¡å‹": "çŸ³", "remarks": ""},
        {"Date": "5/2/2025", "Arriving Time": "14:30", "Leaving Time": "15:45", "è»Šç¨‹": "10 mins", "Location": "Hverfell", "é …ç›®": "Hverfell", "é¡å‹": "ç«å±±", "remarks": ""},
        {"Date": "5/2/2025", "Arriving Time": "", "Leaving Time": "", "è»Šç¨‹": "10 mins", "Location": "ReykjahlÃ­Ã°", "é …ç›®": "ReykjahlÃ­Ã°", "é¡å‹": "ä½å®¿", "remarks": ""},
        {"Date": "5/2/2025", "Arriving Time": "16:15", "Leaving Time": "17:30", "è»Šç¨‹": "7 mins", "Location": "Hverir", "é …ç›®": "Hverir", "é¡å‹": "ç«å±±", "remarks": ""},
        {"Date": "5/2/2025", "Arriving Time": "17:45", "Leaving Time": "18:00", "è»Šç¨‹": "10 mins", "Location": "VÃ­ti", "é …ç›®": "VÃ­ti", "é¡å‹": "ç«å±±", "remarks": ""},
        {"Date": "5/2/2025", "Arriving Time": "18:30", "Leaving Time": "19:30", "è»Šç¨‹": "13 mins", "Location": "MÃ½vatn Nature Baths", "é …ç›®": "JarÃ°bÃ¶Ã°in viÃ° MÃ½vatn", "é¡å‹": "æº«æ³‰", "remarks": ""},
        {"Date": "5/3/2025", "Arriving Time": "10:00", "Leaving Time": "10:45", "è»Šç¨‹": "38 mins", "Location": "Dettifoss", "é …ç›®": "Dettifoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/3/2025", "Arriving Time": "10:45", "Leaving Time": "12:00", "è»Šç¨‹": "1 min", "Location": "Selfoss", "é …ç›®": "Selfoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/3/2025", "Arriving Time": "14:00", "Leaving Time": "15:00", "è»Šç¨‹": "1 hour 38 mins", "Location": "StuÃ°lagil Canyon", "é …ç›®": "StuÃ°lagil Canyon", "é¡å‹": "ç¡¤è°·", "remarks": ""},
        {"Date": "5/3/2025", "Arriving Time": "17:00", "Leaving Time": "17:15", "è»Šç¨‹": "1 hour 47 mins", "Location": "HafnarhÃ³lmi", "é …ç›®": "HafnarhÃ³lmi", "é¡å‹": "é›€", "remarks": ""},
        {"Date": "5/3/2025", "Arriving Time": "17:45", "Leaving Time": "18:30", "è»Šç¨‹": "22 mins", "Location": "Gufufoss", "é …ç›®": "Gufufoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/3/2025", "Arriving Time": "19:30", "Leaving Time": "", "è»Šç¨‹": "1 hour 4 mins", "Location": "EgilsstaÃ°ir", "é …ç›®": "EgilsstaÃ°ir", "é¡å‹": "ä½å®¿", "remarks": ""},
        {"Date": "5/4/2025", "Arriving Time": "11:00", "Leaving Time": "11:15", "è»Šç¨‹": "3 hours 25 mins", "Location": "Stokksnes", "é …ç›®": "Stokksnes", "é¡å‹": "å¤©ç©ºä¹‹é¡", "remarks": ""},
        {"Date": "5/4/2025", "Arriving Time": "12:30", "Leaving Time": "12:45", "è»Šç¨‹": "1 hour 4 mins", "Location": "Diamond Beach", "é …ç›®": "Diamond Beach", "é¡å‹": "æ²™ç˜", "remarks": ""},
        {"Date": "5/4/2025", "Arriving Time": "12:45", "Leaving Time": "13:00", "è»Šç¨‹": "2 mins", "Location": "JÃ¶kulsÃ¡rlÃ³n", "é …ç›®": "JÃ¶kulsÃ¡rlÃ³n", "é¡å‹": "å†°æ²³æ¹–", "remarks": ""},
        {"Date": "5/4/2025", "Arriving Time": "13:15", "Leaving Time": "16:15", "è»Šç¨‹": "14 mins", "Location": "Mulagljufur Canyon", "é …ç›®": "Mulagljufur Canyon", "é¡å‹": "ç¡¤è°·", "remarks": ""},
        {"Date": "5/4/2025", "Arriving Time": "17:00", "Leaving Time": "", "è»Šç¨‹": "23 mins", "Location": "Hof", "é …ç›®": "Hof", "é¡å‹": "ä½å®¿", "remarks": ""},
        {"Date": "5/5/2025", "Arriving Time": "09:20", "Leaving Time": "14:30", "è»Šç¨‹": "19 mins", "Location": "SvÃ­nafellsjÃ¶kull Glacier", "é …ç›®": "SvÃ­nafellsjÃ¶kull Glacier", "é¡å‹": "å†°å·", "remarks": ""},
        {"Date": "5/5/2025", "Arriving Time": "14:45", "Leaving Time": "15:45", "è»Šç¨‹": "12 mins", "Location": "Svartifoss", "é …ç›®": "Svartifoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/5/2025", "Arriving Time": "16:45", "Leaving Time": "17:45", "è»Šç¨‹": "1 hour 1 min", "Location": "FjaÃ°rÃ¡rgljÃºfur", "é …ç›®": "FjaÃ°rÃ¡rgljÃºfur", "é¡å‹": "ç¡¤è°·", "remarks": ""},
        {"Date": "5/5/2025", "Arriving Time": "19:00", "Leaving Time": "", "è»Šç¨‹": "49 mins", "Location": "Vik", "é …ç›®": "Vik", "é¡å‹": "ä½å®¿", "remarks": ""},
        {"Date": "5/6/2025", "Arriving Time": "10:00", "Leaving Time": "10:30", "è»Šç¨‹": "16 mins", "Location": "DyrhÃ³laey", "é …ç›®": "DyrhÃ³laey", "é¡å‹": "é»‘æ²™ç˜", "remarks": ""},
        {"Date": "5/6/2025", "Arriving Time": "11:00", "Leaving Time": "12:00", "è»Šç¨‹": "23 mins", "Location": "SkÃ³gafoss", "é …ç›®": "SkÃ³gafoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/6/2025", "Arriving Time": "12:30", "Leaving Time": "12:45", "è»Šç¨‹": "28 mins", "Location": "Seljalandsfoss", "é …ç›®": "Seljalandsfoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/6/2025", "Arriving Time": "12:50", "Leaving Time": "13:00", "è»Šç¨‹": "3 mins", "Location": "GljÃºfrabÃºi", "é …ç›®": "GljÃºfrabÃºi", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/6/2025", "Arriving Time": "14:30", "Leaving Time": "15:00", "è»Šç¨‹": "1 hour 18 mins", "Location": "Efstidalur II", "é …ç›®": "Efstidalur II", "é¡å‹": "ä½å®¿", "remarks": ""},
        {"Date": "5/6/2025", "Arriving Time": "15:10", "Leaving Time": "15:40", "è»Šç¨‹": "10 mins", "Location": "BrÃºarfoss", "é …ç›®": "BrÃºarfoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/6/2025", "Arriving Time": "16:00", "Leaving Time": "16:30", "è»Šç¨‹": "22 mins", "Location": "Strokkur Geyser", "é …ç›®": "Strokkur Geyser", "é¡å‹": "é–“æ­‡å™´æ³‰", "remarks": ""},
        {"Date": "5/6/2025", "Arriving Time": "16:40", "Leaving Time": "17:10", "è»Šç¨‹": "10 mins", "Location": "Gullfoss", "é …ç›®": "Gullfoss", "é¡å‹": "ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/7/2025", "Arriving Time": "09:00", "Leaving Time": "12:00", "è»Šç¨‹": "47 mins", "Location": "Thingvellir National Park", "é …ç›®": "Ãingvellir", "é¡å‹": "åœ°è³ªå…¬åœ’", "remarks": ""},
        {"Date": "5/7/2025", "Arriving Time": "13:00", "Leaving Time": "16:00", "è»Šç¨‹": "45 mins", "Location": "Glymur Waterfall", "é …ç›®": "Glymur Waterfall", "é¡å‹": "ç¡¤è°·ç€‘å¸ƒ", "remarks": ""},
        {"Date": "5/7/2025", "Arriving Time": "17:15", "Leaving Time": "", "è»Šç¨‹": "1 hour 7 mins", "Location": "ReykjavÃ­k", "é …ç›®": "", "é¡å‹": "ä½å®¿", "remarks": ""},
        {"Date": "5/8/2025", "Arriving Time": "08:30", "Leaving Time": "11:30", "è»Šç¨‹": "37 mins", "Location": "Inside the Volcano", "é …ç›®": "Inside the Volcano", "é¡å‹": "ç«å±±", "remarks": ""},
        {"Date": "5/8/2025", "Arriving Time": "12:00", "Leaving Time": "15:00", "è»Šç¨‹": "36 mins", "Location": "Reykjadalur", "é …ç›®": "Reykjadalur Hot Spring", "é¡å‹": "æº«æ³‰æ²³", "remarks": ""},
        {"Date": "5/8/2025", "Arriving Time": "16:00", "Leaving Time": "19:00", "è»Šç¨‹": "1 hour 0 mins", "Location": "Fagradalsfjall Volcano", "é …ç›®": "Fagradalsfjall Volcano", "é¡å‹": "ç«å±±", "remarks": ""},
        {"Date": "5/8/2025", "Arriving Time": "", "Leaving Time": "", "è»Šç¨‹": "31 mins", "Location": "KeflavÃ­k Airport", "é …ç›®": "KeflavÃ­k Airport", "é¡å‹": "ä½å®¿", "remarks": ""}
    ];

    // Storage Key
    const STORAGE_KEY = 'iceland_trip_data_v2';
    
    // Global State
    let itinerary = [];
    let isEditMode = false;
    let editingIndex = -1;

    // Load Data
    function loadData() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            try {
                itinerary = JSON.parse(saved);
            } catch(e) {
                console.error("Parse error, loading initial", e);
                itinerary = JSON.parse(JSON.stringify(initialData));
            }
        } else {
            // Deep copy initial data
            itinerary = JSON.parse(JSON.stringify(initialData));
        }
    }

    function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(itinerary));
    }

    // Actions
    function toggleEditMode() {
        isEditMode = !isEditMode;
        document.body.classList.toggle('edit-mode', isEditMode);
        const btn = document.querySelector('.toggle-edit');
        btn.classList.toggle('active', isEditMode);
        btn.innerText = isEditMode ? 'å®Œæˆç·¨è¼¯' : 'ç·¨è¼¯æ¨¡å¼';
    }

    function deleteItem(index) {
        if(confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å—ï¼Ÿ')) {
            itinerary.splice(index, 1);
            saveData();
            render();
        }
    }

    function moveItem(index, direction) {
        // direction: -1 for up, 1 for down
        const newIndex = index + direction;
        if (newIndex < 0 || newIndex >= itinerary.length) return;

        // Swap
        const temp = itinerary[index];
        itinerary[index] = itinerary[newIndex];
        itinerary[newIndex] = temp;
        
        saveData();
        render();
    }

    function searchLocation(loc) {
        if(!loc) return;
        const query = encodeURIComponent(loc);
        window.open(`https://www.google.com/search?q=${query}`, '_blank');
    }

    // Modal Logic
    function openAddModal() {
        editingIndex = -1; // -1 means adding new
        document.getElementById('modalTitle').innerText = "æ–°å¢è¡Œç¨‹";
        
        // Guess date from last item
        const lastItem = itinerary[itinerary.length - 1];
        document.getElementById('inpDate').value = lastItem ? lastItem.Date : "5/1/2025";
        
        document.getElementById('inpArrTime').value = "";
        document.getElementById('inpLeaveTime').value = "";
        document.getElementById('inpLocation').value = "";
        document.getElementById('inpName').value = "";
        document.getElementById('inpRemark').value = "";
        
        document.getElementById('itemModal').classList.add('active');
    }

    function openEditModal(index) {
        editingIndex = index;
        const item = itinerary[index];
        document.getElementById('modalTitle').innerText = "ä¿®æ”¹è¡Œç¨‹å…§å®¹";
        
        document.getElementById('inpDate').value = item.Date || "";
        document.getElementById('inpArrTime').value = item['Arriving Time'] || "";
        document.getElementById('inpLeaveTime').value = item['Leaving Time'] || "";
        document.getElementById('inpLocation').value = item.Location || "";
        document.getElementById('inpName').value = item['é …ç›®'] || "";
        document.getElementById('inpRemark').value = item.remarks || "";
        
        document.getElementById('itemModal').classList.add('active');
    }

    function closeModal() {
        document.getElementById('itemModal').classList.remove('active');
    }

    function saveItem() {
        const date = document.getElementById('inpDate').value;
        const loc = document.getElementById('inpLocation').value;
        if(!date || !loc) {
            alert("æ—¥æœŸå’Œåœ°é»æ˜¯å¿…å¡«çš„");
            return;
        }

        const newItem = {
            "Date": date,
            "Arriving Time": document.getElementById('inpArrTime').value,
            "Leaving Time": document.getElementById('inpLeaveTime').value,
            "Location": loc,
            "é …ç›®": document.getElementById('inpName').value,
            "remarks": document.getElementById('inpRemark').value,
            "é¡å‹": "è‡ªè¨‚", 
            "è»Šç¨‹": ""
        };

        if(editingIndex === -1) {
            // Add new
            itinerary.push(newItem);
        } else {
            // Update existing
            // Keep existing fields like 'è»Šç¨‹' if we didn't edit them, but here we simplify
            const oldItem = itinerary[editingIndex];
            itinerary[editingIndex] = { ...oldItem, ...newItem };
        }
        
        saveData();
        render();
        closeModal();
    }

    // Render
    function render() {
        const app = document.getElementById('app');
        app.innerHTML = '';
        
        let lastDate = '';

        itinerary.forEach((item, index) => {
            // Date Header
            if (item.Date !== lastDate) {
                const dateHeader = document.createElement('div');
                dateHeader.className = 'date-header';
                dateHeader.innerText = `ğŸ“… ${item.Date}`;
                app.appendChild(dateHeader);
                lastDate = item.Date;
            }

            const card = document.createElement('div');
            card.className = `card type-${item['é¡å‹'] || 'default'}`;
            
            // Time display
            let timeDisplay = item['Arriving Time'] || '--:--';
            if(item['Leaving Time']) timeDisplay += ` - ${item['Leaving Time']}`;

            // HTML Structure
            card.innerHTML = `
                <div class="card-header">
                    <span class="time-badge">${timeDisplay}</span>
                </div>
                
                <div class="location-row" onclick="searchLocation('${item.Location.replace(/'/g, "\\'")}')">
                    <div class="location">${item.Location}</div>
                    <div class="search-icon">ğŸ”</div>
                </div>
                
                <div class="item-name">${item['é …ç›®'] || ''}</div>
                
                <div class="tags">
                    ${item['é¡å‹'] ? `<span class="tag">${item['é¡å‹']}</span>` : ''}
                    ${item['è»Šç¨‹'] ? `<span class="tag drive">ğŸš— ${item['è»Šç¨‹']}</span>` : ''}
                </div>

                <div class="remark-box" onclick="openEditModal(${index})">
                    ${item.remarks ? item.remarks : '<span class="remark-placeholder">é»æ“Šè¼¸å…¥å‚™è¨»...</span>'}
                </div>

                <div class="edit-controls">
                    <button class="btn btn-edit-content" onclick="openEditModal(${index})">âœï¸ å…§å®¹</button>
                    <button class="btn btn-up" onclick="moveItem(${index}, -1)">â¬†ï¸</button>
                    <button class="btn btn-down" onclick="moveItem(${index}, 1)">â¬‡ï¸</button>
                    <button class="btn btn-del" onclick="deleteItem(${index})">ğŸ—‘ï¸</button>
                </div>
            `;
            app.appendChild(card);
        });
    }

    // Start
    loadData();
    render();
    
    // Close modal click outside
    window.onclick = function(ev) {
        if(ev.target == document.getElementById('itemModal')) closeModal();
    }

</script>

</body>
</html>
